---
title: "Firestore技術メモ"
templateKey: blog-post
date: 2020-07-09T14:59:00+09:00
tags: [Firebase, "Cloud Firestore"]
draft: true
---

コレクション, ドキュメント, コレクション, ドキュメント... の並びでしか入ることはない

ドキュメントはキーと値のペアが入る（小型推奨）
ドキュメントは、ネスとされたオブジェクト（＝マップ）、サブコレクションが入る

<!--more-->

コレクションは単なるドキュメントのコンテナである
コレクション内のドキュメントの名前は、(1) 独自のキー、(2)Firestore が生成するランダムな ID を使える
コレクションは自動生成される。コレクション内の全てのドキュメントを削除するとコレクションは存在しなくなる

サブコレクションは、特定のドキュメントに関連付けられたコレクションである。
現時点では複数のサブコレクションにまたがるクエリーはサポートされていない。複数のコレクションに対してデータのクエリを実行する必要がある場合は、ルートレベルのコレクションを使用する

ドキュメントを削除しても、サブコレクションは削除されない。削除する場合には、手動で削除する必要がある
ドキュメントのサブコレクションの一覧の取得`getCollections()`はウェブとモバイルでは使用不可。言語としては Java,Node.js のみ。

ドキュメントのリアルタイムアップデートの入手には、onSnapshot を使用する。ローカルでの変更では直ちにリスナーが起動する。
受け取るイベントの詳細レベルは onSnapshot()の引数で指定できる。デフォルトでは、メタデータにのみ影響する変更はリスナーに通知されない。メタデータの例は、metadata.hasPendingWrites(保留中の書き込み)
※書き込みが完了したことだけを知りたい場合は、代わりに完了コールバックを listen する。

## データ型

- 配列
- ブール
- バイト
- 日時
- 浮動小数点
- 座標
- マップ
- Null
- 参照
- テキスト文字列
